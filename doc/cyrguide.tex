\documentstyle[11pt,twoside]{cyrguide}

\input{header}

\section{Введение}

\subsection{Краткое описание продукта}

DECO~--- экранная оболочка для операционных систем семейства Unix,
построенная по принципу наглядности и рассчитанная на
работу как неквалифицированного пользователя, так и программиста.
По интерфейсу DECO во многом похож на хорошо известный ``Norton Commander''.
DECO позволяет:

\begin{itemize}
\item
Отображать постоянно информацию об имени пользователя, имени системы,
терминале, дату и время, что важно при работе в сетях ЭВМ.
\item
Осуществлять наглядное движение по дереву файлов ОС Unix.
\item
Отображать одновременно на экране терминала один или два справочника,
отмечать в них файлы, копировать, удалять, связывать или переименовывать
файлы, сравнивать справочники.
\item
Выполнять любые команды OC Unix, используя для их конструирования при
необходимости имена отмеченных файлов.
\item
Просматривать и редактировать файлы, используя как встроенные, так и
стандартные программы.
\item
Повторять команды, используя ``историю работы''.
\item
Задавать формат окон, степень подробности информации о файлах,
способ просмотра и редактирования файлов и другие атрибуты системы;
запоминать настройку в файле.
\item
Создавать пользовательские меню и вызывать программы через систему
меню.
\end{itemize}

DECO может работать на любом терминале, подключенном к ОС Unix,
если этот терминал имеет прямую адресацию курсора на экране, большие и
маленькие буквы и описан в системе. Желательно иметь на терминале набор
функциональных клавиш. Удобно также использовать клавиши
{\tt <PgUp>}, {\tt <PgDn>}, {\tt <Ins>}, {\tt <Del>}
или им аналогичные (см. также раздел ``Освоение клавиатуры'').

Поскольку в стандартных для Unix описаниях терминала не предусмотрены
ни описания десяти функциональных клавиш, ни установка цвета, ни
псевдографика, DECO использует расширенное (по сравнению с общепринятым)
описание терминалов в формате {\em termcap},
причем имеет свой файл дополнений к termcap,
который может использоваться совместно с системными описаниями.
Подробнее описание расширенного варианта termcap приведено в
документе ``Особенности реализации DECO''.

\subsection{Условные обозначения}

В данном руководстве приняты следующие условные обозначения:

\begin{itemize}
\item
При описании клавиатуры~{\tt \^{}X} означает управляющий символ~X,
{\tt FX} означает функциональную клавишу~X, а {\tt <Enter>}~--- клавишу
``Enter'' или ``Return'' (см. раздел ``Освоение клавиатуры'').
\item
В типографском варианте документации рисунки экрана приведены в
черно-белом изображении.
\end{itemize}

Все примеры, если это не оговорено отдельно, приведены для работы
пользователя ``alex'' на машине под именем ``berta'' в
каталоге {\tt /usr/user}, в котором есть подкаталоги {\tt doc} и {\tt w}.

\section{История разработки}

\fig{p1}{screen}{Начальный экран}

Одним из важных факторов, влияющих на удобство работы с ЭВМ,
является язык взаимодействия пользователя и системы.

В коллективе программистов, занимавшихся разработками программ для
отечественных ЭВМ, работающих под ОС семейства Unix,
было разработано несколько экранных интерфейсов для Unix. Большинство
из них использовались самими авторами для личных потребностей, но некоторые
получили определенное распространение среди конечных пользователей.
Анализ показал, что в отличие от системных программистов, пользователей
интересует скорее простота освоения и наглядность системы, и они готовы
простить некоторую ее неполноту и даже (в ряде случаев) неэффективность.
С появлением персональных компьютеров требования пользователей возросли,
и имеющиеся в Unix экранные интерфейсы перестали их устраивать.

При разработке DECO авторы исходили из того, что значительное большинство
конечных пользователей Unix имеют опыт работы на персональных компьютерах,
а наиболее популярным командным интерфейсом там является
экранная программа NC~--- Norton Commander. При всех ее недостатках
возможности, предоставляемые NC, удовлетворяют большинство пользователей.
Везде, где это возможно, повторялся интерфейс программы NC, чтобы
пользователи NC могли пользоваться DECO без дополнительной подготовки.

Естественно, условия при работе на персональном компьютере в MS-DOS
и на терминале в ОС Unix несколько разные. Разные не только терминал и
клавиатура, но и типичная операционная обстановка (например,
длина полного имени файлов и размеры файловых систем), и
возможности операционной системы (например, связывание файлов в Unix),
и потребности пользователей. Поэтому работа команд DECO часто отличается
от работы аналогичных им команд NC.

\section{Базовые концепции}

\subsection{Вызов DECO}

Предположим, что вы работаете на машине ``berta'' под именем ``alex'' и
хотите использовать справочник {\tt w}.
Для вызова DECO нужно набрать:

\begin{source}
\begin{verbatim}
deco w
\end{verbatim}
\end{source}

На экране появится картинка, изображенная на рис.~\ref{screen}.
Подробное описание картинки будет приведено позже.
Для начала необходимо научиться работать с клавиатурой. Дело в том, что DECO
рассчитан на использование функциональной клавиатуры, а она сильно
зависит от типа терминала.

Вызовем экран подсказки. Если вы работаете за консолью PC, нажмите клавишу
{\tt F1}. Если у вас терминал, совместимый с широко распространенными
терминалами VT--100, VT--200, VT--300 фирмы DEC, нажмите клавишу~{\tt -1-}
на цифровой клавиатуре справа. На некоторых терминалах с десятью
функциональными клавишами подсказка будет вызываться по клавише {\tt F1},
аналогично консоли PC. Если у вас ничего не получилось, то это признак
неправильной установки DECO или неправильной настройки системы на ваш терминал.
Но даже в этом случае, если картинка на экране соответствует рис.~\ref{screen},
DECO может работать. Нажмите клавишу {\tt <Escape>} и затем
цифру 1 на основной клавиатуре (на некоторых терминалах вместо {\tt <Escape>}
приходится вводить {\tt \^{}[}~--- нажать {\tt <Ctrl>} и символ {\tt [}
одновременно). Если и в этом случае ничего не
произошло, либо начальная картинка не появилась, обратитесь к
руководству по установке системы, вероятнее всего ваш терминал не описан в
системе, либо его тип не указан или указан неправильно.

\fig{p2}{help}{Подсказка}

Если все сделано правильно, появится картинка на рис.~\ref{help}.
Это краткая подсказка. Она предназначена в
основном для тех, кто имеет представление
о командах DECO, но забыл, как они вводятся.
Команды подробно расшифрованы дальше,
а условные обозначения для клавиш уже приводились:~{\tt \^{}X}
означает символ {\tt <Ctrl>}+X.

Для выхода из подсказки достаточно нажать любую клавишу.

Еще один способ получить подсказку, даже более полную, чем по
клавише {\tt F1},--- вызвать основное меню DECO клавишей {\tt F9}. В нем
описаны как команды, выполняемые через это меню, так и их
выполнение через {\tt <Ctrl>}-символы (в тех случаях, когда
это возможно). Подробно основное меню описано ниже в разделе
``Расширенные возможности DECO''.

\subsection{Освоение клавиатуры}

В отличие от многих экранных оболочек, DECO рассчитан на
полное использование возможностей клавиатуры терминала.
В данном руководстве все обозначения клавиш приведены
для стандартной клавиатуры PC AT.
На других терминалах клавиши могут обозначаться по-другому.
На некоторых терминалах часть функциональных клавиш
может отсутствовать. В этом случае вместо них используются
управляющие символы (например,~{\tt \^{}T}), либо комбинации из двух
символов: {\tt <Escape>}~+ символ (например, {\tt <Escape>} u).

Как правило, применяются клавиши со сходными названиями.
Вместо {\tt F1}$\ldots${\tt F10} на большинстве терминалов используют
клавиши {\tt -1-}$\ldots${\tt -9-}, {\tt -0-} дополнительной цифровой клавиатуры
(она расположена на терминале справа).

Таблица~\ref{keyboard} содержит информацию о замене клавиш.

\begin{table}[bp]
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
Клавиша & Клавиша & Альтернативный \\
PC AT & VT--220 & ввод \\
\hline
Enter & Return & \^{}M \\
F1 & -1- & Escape 1 \\
F2 & -2- & Escape 2 \\
F3 & -3- & Escape 3 \\
F4 & -4- & Escape 4 \\
F5 & -5- & Escape 5 \\
F6 & -6- & Escape 6 \\
F7 & -7- & Escape 7 \\
F8 & -8- & Escape 8 \\
F9 & -9- & Escape 9 \\
F10 & -0- & Escape 0 \\
$\uparrow$ & вверх & Escape u \\
$\downarrow$ & вниз & Escape d \\
$\leftarrow$ & влево & Escape l \\
$\rightarrow$ & вправо & Escape r \\
Home & Home & Escape h \\
End & End & Escape e \\
PgUp & PrevPage & Escape p \\
PgDn & NextPage & Escape n \\
Ins & Ins & \^{}T \\
Del & Del & \^{}G \\
\hline
\end{tabular}
\caption{Использование клавиатуры}
\label{keyboard}
\end{center}
\end{table}

\subsection{Выход из DECO и отмена выполнения команд}

Для выхода из DECO нужно нажать клавишу {\tt F10},
или соответствующую ей клавишу на терминале:~{\tt -0-} справа
внизу на VT--220 или VT--100, {\tt <Escape>}~0~--- если такой
клавиши нет вообще. Можно также нажать {\tt <Ctrl>~C} ({\tt \^{}C}).
Система переспрашивает пользователя (рис.~\ref{quit}).

\fig{p3}{quit}{Запрос о выходе}

На картинке представлены три варианта возможных действий системы.
Нужно выбрать ответ и нажать {\tt <Enter>}.
Для выбора ответа используются клавиши со стрелками
``$\leftarrow$'' и ``$\rightarrow$''
или клавиша {\tt <Tab>}, текущий ответ выделяется инверсией.
Действия DECO:

\begin{example}
\litem{Yes}
Выход. Пользователь оказывается в том каталоге, откуда был вызван DECO.
\litem{No}
Продолжение работы.
\litem{Exec shell}
Вместо DECO вызывается стандартный интерпретатор команд ({\tt /bin/sh}
по умолчанию), при этом пользователь остается в текущем каталоге.
\end{example}

Клавиша {\tt F10} (или~{\tt \^{}C})
имеет важное значение. Это команда отмены выполнения текущего действия.
Если пользователь вызвал какое-либо меню DECO
или встроенную команду (просмотр или редактирование файлов), то
{\tt F10} прерывает ее и возвращает DECO в исходное
состояние. Например, если в обычном режиме нажать {\tt F10} дважды,
то после первого нажатия появится вопрос о выходе из DECO, а второе нажатие
сотрет этот вопрос и восстановит экран.

Еще один способ выйти из DECO~--- ввести команду {\tt exit}
(набрать слово ``exit'' в командной строке и нажать {\tt <Enter>}).
Эта команда приводит к немедленному выходу из DECO.

Многие привыкли пользоваться для выхода из
программ клавишей {\tt <Escape>}. В DECO одиночное нажатие {\tt <Escape>}
работает как команда выхода, но срабатывает с задержкой в две секунды.
Это связано с необходимостью отличить клавишу {\tt <Escape>} от прочих
функциональных клавиш. Чтобы сэкономить время, можно использовать
два нажатия клавиши {\tt <Escape>} подряд.

\subsection{Как восстановить экран}

ОС Unix~--- система многозадачная. Может случиться, что при
работе DECO какая-либо посторонняя задача выдаст что-либо на терминал,
может возникнуть ошибка в линии связи с терминалом,
может прийти сообщение от системы (например,
сообщение о скором окончании работы). Для восстановления экрана
терминала во всех случаях используется команда~{\tt \^{}]}.
При этом информация на экране стирается и изображение выводится заново.

\subsection{Что изображено на экране}

Вызовем DECO. На экране появится одна из возможных
картинок (рис.~\ref{screen}). Имеется четыре формата экрана и несколько
режимов их выдачи, которые устанавливаются командами DECO. Эти
команды описаны ниже.

Верхняя строка содержит информацию о
системе, терминале и пользователе (это достаточно актуально~---
представьте себе работу в сети на сетевой файловой системе; в этом случае
имя машины, имя терминала и имя пользователя необходимо знать).
Ниже расположены два {\em окна} (слева и справа), которые соответствуют двум
справочникам системы. Одно из окон~--- текущее, его имя выделено
инверсией или цветом, другое используется в командах копирования,
сравнения, для выдачи информации о рабочем окне и т.д.
По умолчанию текущее окно~--- левое.

В окнах изображены файлы из соответствующего каталога.
Символ слева от имени обозначает тип файла. Возможные типы файлов
перечислены в таблице~\ref{filetypes}.

\begin{table}[bp]
\begin{center}
\begin{tabular}{|cl|}
\hline
Обозначение & Тип файла \\
\hline
пробел & обычный файл \\
{\tt *} & выполняемый файл \\
{\tt /} & справочник \\
{\tt \&} & справочник, недоступный для входа \\
{\tt \$} & байт-ориентированное устройство \\
{\tt \#} & блок-ориентированное устройство \\
{\tt =} & труба (FIFO) \\
{\tt @} & символьная ссылка (symlink) \\
{\tt \~{}} & символьная ссылка на отсутствующий файл \\
{\tt !} & гнездо (socket) \\
\hline
\end{tabular}
\caption{Типы файлов}
\label{filetypes}
\end{center}
\end{table}

Если у имени файла есть расширение (правая часть имени с точкой),
оно обычно отделяется от имени и выравнивается вправо.
Файлы упорядочены по типам, по расширениям и по именам (по алфавиту).
Способ сортировки имен файлов и режим отделения расширения можно
изменить (см. раздел ``Основное меню DECO'').

Один из файлов в текущем окне выделен инверсией или цветом~--- это
{\em текущий} файл. Ниже основного окна показываются имя и
некоторые атрибуты текущего файла.
По умолчанию выдаются: имя, длина (для обычных файлов)
или тип (для остальных), режимы доступа в таком же формате, как и
в команде ``{\tt ls~-l}'' (см. ls~(1)).

Следующая строка предназначена для ввода команд.
Приглашением служит имя текущего справочника.

И, наконец, нижняя строчка содержит {\em подсказку}~---
названия команд, выполняющихся при нажатии клавиш {\tt F1}$\ldots${\tt F10}.

\subsection{Движение по справочникам}

Для движения внутри текущего справочника используются
клавиши со стрелками. При этом указатель текущего файла
двигается по окну, а если он дошел до границы окна, то список файлов в
окне сдвигается в нужную сторону. Можно передвигаться сразу на много файлов,
используя клавиши {\tt <PgUp>} и {\tt <PgDn>}.

Для перехода из левого окна в правое и обратно служит клавиша {\tt <Tab>}
({\tt \^{}I}).

Перейти в другой справочник можно, выбрав его имя на экране и нажав
клавишу {\tt <Enter>}. Поскольку имя ``{\tt ..}'' указывает на
предшествующий в дереве справочник, таким способом можно
добраться до любого справочника файловой системы.

Существует много других способов движения по файловой системе.
Они рассматриваются ниже в разделе ``Передвижение по файловой системе''.

\subsection{Ответы на запросы}

В процессе работы DECO может делать запросы.
Он спрашивает имя справочника, куда нужно перейти по команде~{\tt \^{}R},
имя файла или справочника по команде копирования или
переименования, и многое другое. Нужно уметь отвечать на такие запросы.
Для примера рассмотрим команду~{\tt \^{}R}~--- изменение имени справочника.

\fig{p5}{dirname}{Запрос имени справочника}

После нажатия~{\tt \^{}R} DECO выдаст запрос (рис.~\ref{dirname}).
Курсор становится на поле имени, в котором
высвечивается умолчание для данной команды (в данном случае
имя текущего справочника). У пользователя есть выбор:
\begin{itemize}
\item
Отменить запрос вместе с командой, нажав {\tt F10}.
\item
Нажать {\tt <Enter>}, в этом случае используется умолчание.
\item
Ввести новое имя; если курсор стоял на начале строки (как, например, в
командах копирования), то
после ввода первого символа текст справа от
курсора исчезнет.
\item
Отредактировать имя, принятое по умолчанию.
\end{itemize}

Команды редактирования:
\begin{example}
\litem{$\leftarrow$, $\rightarrow$}
Движение по редактируемой строке.
\litem{{\tt <Tab>}}
Переход в начало или конец имени.
\litem{{\tt <BackSpace>}}
Стирание символа слева от курсора.
\litem{{\tt \^{}Y}}
Стирание всей редактируемой строки.
\litem{{\tt <Del>} или {\tt \^{}G}}
Стирание символа прямо под курсором.
\end{example}
Любой другой символ вставляется, раздвигая текст.

Нажмем {\tt F10}, картинка исчезнет.

\subsection{Диагностика ошибок}

В случае ошибки DECO выдает запрос с диагностикой и предложением подтвердить,
что она прочитана. Для продолжения работы нужно нажать любую клавишу.
Пример такой выдачи приведен на рис.~\ref{error}.

\fig{p6}{error}{Сообщение об ошибке}

\subsection{Использование меню}

Выше были рассмотрены два вида команд DECO: команды, вызываемые
функциональными клавишами (например, справка вызывается по клавише
{\tt F1}), и команды, вызываемые по {\tt <Ctrl>}-символам
(например, {\tt \^{}R}~--- смена справочника). Третий, универсальный
способ~--- воспользоваться основным меню. Для этого нужно нажать
клавишу~{\tt F9}. Вверху экрана появится строка с возможными вариантами
меню (рис.~\ref{menu}).

\fig{p7}{menu}{Меню}

Надписи ``Left'', ``Files'' и~т.~п. означают
возможные варианты меню. Требуемое меню можно выбрать с помощью
стрелки влево и стрелки вправо. Каждое меню состоит
из команд. Справа от некоторых команд выводится их обозначение,
позволяющее вызывать эти команды без вызова меню (любую команду DECO
можно вызвать через меню, так что оно является кроме всего
прочего дополнением к подсказке). Слева от некоторых команд, управляющих
установками режимов, может стоять символ~`{\tt *}', означающий, что
режим включен. Команду в меню можно вызвать,
выбрав ее стрелкой вверх и стрелкой вниз и нажав
{\tt <Enter>}. Как всегда, меню можно отменить, нажав~{\tt F10}.

После выполнения команды происходит выход из меню.
Для выполнения команды, оставаясь в меню, нужно нажать клавишу~{\tt \^{}J}.

Для примера вызовем команду перерисовки экрана, пользуясь меню.
Сначала нажмем два раза стрелку влево, перейдя в меню ``Commands''.
Затем выберем стрелками команду перерисовки экрана
(рис.~\ref{redraw}), нажмем {\tt <Enter>}, и команда выполнится.

\fig{p8}{redraw}{Перерисовка экрана}

\section{Основные возможности DECO}

\subsection{Выбор файловых систем и файлов}

\subsubsection{Передвижение по файловой системе}

Перейдем теперь к работе в DECO. Первое его назначение~---
облегчить движение по справочникам.

Один из файлов в текущем окне (см. рис.~\ref{screen}) выделен цветом
или инверсией~--- это текущий файл. На терминалах, не имеющих инверсии,
для выделения используются квадратные скобки.

Клавиши со стрелками позволяют двигаться по окну, выбирая
любой файл справочника. Если справочник большой, можно листать его
по страницам с помощью клавиш {\tt <PgUp>} и {\tt <PgDn>}.
{\tt <Home>} и {\tt <End>} позволяют переходить соответственно в начало
и конец справочника.

Как перейти в другой справочник? Первый способ~--- выбрать курсором
имя справочника и нажать {\tt <Enter>}. Например, выберем
файл ``{\tt ..}'' и нажмем {\tt <Enter>}. Поскольку файл ``{\tt ..}''
ссылается на ``родительский'' справочник, мы попадем в справочник
{\tt /usr/user}, причем текущим окажется справочник,
в котором мы только что находились, то есть {\tt w}
(см. рис.~\ref{dirw}). Нажав {\tt <Enter>} еще раз, вернемся снова
в справочник~{\tt w}.

\fig{p9}{dirw}{Каталог {\tt w}}

Второй способ сменить текущий справочник~--- набрать~{\tt \^{}R}.
Система выдаст запрос имени справочника (рис.~\ref{dirname}). Введем:
\begin{example}
\litem{{\tt \^{}Y}}
Строка сотрется.
\litem{{\tt /}}
Выберем имя каталога.
\litem{{\tt <Enter>}}
DECO перейдет в корневой каталог (рис.~\ref{root}). Вернуться назад можно,
перейдя последовательно в справочники {\tt usr}, {\tt user}, {\tt w}.
\end{example}

\fig{p10}{root}{Корневой каталог}

Третий способ~--- выполнить команду {\tt cd}:
\begin{source}
\begin{verbatim}
cd имя_справочника
\end{verbatim}
\end{source}
или
\begin{source}
\begin{verbatim}
cd
\end{verbatim}
\end{source}
Если ``имя\_справочника'' не указано, подразумевается домашний справочник.

Введите команду~{\tt cd} (и нажмите {\tt <Enter>}). DECO перейдет
в домашний справочник. Наберите~``{\tt cd w}''. Снова возникнет картинка,
изображенная на рис.~\ref{screen}.

Еще одна возможность~--- переход из левого окна в правое и обратно, при
этом соответственно меняется и текущий справочник DECO. Для перехода
используется клавиша {\tt <Tab>}. Можно также поменять
окна местами по команде~{\tt \^{}U}.

Например, попробуем вывести в правое окно список команд
в справочнике~{\tt /bin}. Для этого наберем:

\begin{example}
\litem{{\tt \^{}I}}
Переход в правое окно.
\litem{{\tt \^{}R}}
Появится запрос, рис.~\ref{error}.
\litem{{\tt /bin}}
Введем имя справочника.
\litem{{\tt <Enter>}}
Выполним переход, нажав клавишу ввода.
\litem{{\tt \^{}I}}
Возврат в левое окно.
\end{example}

Картинка на экране приведена на рис.~\ref{bin}.

\fig{p11}{bin}{Каталог {\tt /bin}}

\subsubsection{Поиск файла по имени}

Если справочник большой, листать его в поисках нужного файла
достаточно сложно. В этом случае поможет команда поиска файла по
имени~({\tt \^{}K}).
Рассмотрим состояние DECO на рис.~\ref{bin}.
Перейдем в справочник {\tt /bin} (нажав~{\tt \^{}I}), и
попробуем быстро найти там команду выдачи календаря {\tt cal}.
Нажмем~{\tt \^{}K}. Появится запрос (рис.~\ref{ca}).
Введем начало имени файла, который мы ищем: ``{\tt ca}'',
и нажмем {\tt <Enter>}. Курсор установится на ближайший файл в
справочнике, начало имени которого совпадает с~{\tt ca} (в данном случае
это файл~{\tt cal}.

\fig{p12}{ca}{Быстрый поиск файла}

\subsubsection{Отметка файлов и ее использование}

DECO позволяет {\em помечать} файлы для дальнейших манипуляций с
ними. Если выбрать файл {\tt tsimp.exe} и нажать {\tt <Ins>} (или~{\tt \^{}T}), то
его имя будет помечено знаком~`{\tt >}', и выделено цветом.
При этом курсор сдвигается вниз, что позволяет пометить сразу
несколько подряд идущих файлов, не пользуясь стрелками.

\fig{p13}{tagged}{Помеченные файлы}

На рисунке~\ref{tagged} помечены файлы {\tt tsimp.exe}, {\tt tsimp.f},
{\tt tsimp.o}. Повторное нажатие Ins над помеченным файлом снимает пометку.

\fig{p14}{unselect}{Снятие отметки}

Иногда нужно пометить или снять пометку сразу с нескольких файлов.
Для этого нужно нажать~`{\tt +}' (чтобы пометить) или~`{\tt -}'
(чтобы снять пометку). Появится запрос (рис.~\ref{unselect}).
Нужно ввести имя файла или шаблон имени файла (см. раздел ``Шаблоны''),
и файлы, удовлетворяющие этому шаблону, будут помечены (или
пометка с них будет снята). По умолчанию используется шаблон~`{\tt *}'.

Введем~`{\tt -}', в ответ на запрос введем~``{\tt *.o}''
и нажмем {\tt <Enter>}. DECO снимет отметку с файла~{\tt tsimp.o},
удовлетворяющего данному шаблону.

Команды~`{\tt +}' и~`{\tt -}' работают только в том случае,
если командная строка пуста. Для стирания командной строки
используется команда~{\tt \^{}Y}.

\subsubsection{Шаблоны}

Во многих командах DECO (снятие и установка отметки,
установка шаблона экрана) используется {\em шаблон имени}.
При сравнении с шаблоном некоторые символы трактуются
специальным образом (почти так же, как в расширениях имен в
интерпретаторах shell и cshell):

\begin{example}
\litem{{\tt *}}
Любое число произвольных символов, в том числе и ни одного.
\litem{{\tt ?}}
Один произвольный символ.
\litem{{\tt [ab0-9]}}
Любой символ из указанного набора.
\litem{{\tt [\^{}ab0-9]}}
Любой символ, кроме перечисленных.
\litem{{\tt \^{}}}
В первой позиции~--- любое имя, не удовлетворяющее шаблону.
\end{example}

Например, шаблон~{\tt *.o} соответствует именам {\tt tsimp.o}, {\tt fsplit.o},
и не соответствует {\tt tsimp.f}, шаблон ``{\tt \^{}*.[ob]}'' соответствует любым
именам, кроме оканчивающихся на ``{\tt .o}'' и ``{\tt .b}''.

\subsection{Конструирование и выполнение команд}

\subsubsection{Выполнение файлов}

Простейший способ выполнить файл в DECO~--- выбрать этот файл на экране и
нажать {\tt <Enter>}. При этом действия DECO зависят от типа и имени файла.
Если файл выполняемый, его имя переносится в командную строку и
команда выполняется. Если же файл обычный без признака выполнения,
командная строка формируется по некоторым правилам. После выполнения команды
снова выдается приглашение в виде имени текущего каталога.
Чтобы вернуться в экранный режим, нужно нажать {\tt <Enter>}.
После нажатия восстанавливается экран DECO.

Для примера выполним команду {\tt cal}. Эта команда
находится в справочнике {\tt /bin}, который показан в нашем
примере (рис.~\ref{bin}) справа. После выполнения предыдущего
примера этот файл уже выбран, иначе нужно ввести:

\begin{example}
\litem{{\tt \^{}I}}
Перейти в правое окно.
\end{example}

Пользуясь стрелками и клавишами {\tt <PgUp>} и {\tt <PgDn>}, выбрать файл
{\tt cal}. Теперь осталось только нажать {\tt <Enter>}.
Выдача показана на рис.~\ref{execution}.

\fig{p15}{execution}{Пример выполнения команды}

Нажмем {\tt <Enter>}, восстановится экран DECO.
Затем введем~{\tt \^{}I}, чтобы вернуться в левое окно.

\subsubsection{Ввод и выполнение команд}

Можно работать в DECO как в любом интерпретаторе команд~---
вводить команды Unix и нажимать {\tt <Enter>}. При этом для
запуска команд используется один из стандартных интерпретаторов
команд, так что пользователь может набирать команды так, как он привык,
используя символы~``{\tt *}'', ``{\tt ?}'' и другие специальные символы.
Единственное ограничение: интерпретатор вызывается каждый раз заново,
в результате переменные и настройки (например, синонимы) не сохраняются.

Однако, в DECO пользователь имеет дополнительные возможности. Он может:

\begin{itemize}
\item
Редактировать строку, пользуясь клавишами:

\begin{example}
\litem{{\tt <BackSpace>}}
Отменить символ слева от курсора.
\litem{{\tt <Del>} или {\tt \^{}G}}
Отменить символ под курсором.
\litem{{\tt \^{}A}}
Движение по строке влево.
\litem{{\tt \^{}D}}
Движение по строке вправо.
\end{example}

\item
Подставить в строку имя текущего файла (или список отмеченных
файлов, см. ниже), нажав~{\tt \^{}J};
\item
Подставить одну из предыдущих команд, нажав~{\tt \^{}E};
\item
Перейти в режим редактирования строки клавишами со стрелками,
нажав~{\tt \^{}P}. Повторное нажатие~{\tt \^{}P} вернет DECO назад в
режим выбора файла. Редактирование строки описано в разделе ``Ответы
на запросы'' (стрелки влево, вправо, {\tt <Tab>}, {\tt \^{}G}, {\tt <Del>}),
добавляются только команды движения по словам: стрелка
вверх перемещает курсор на слово назад, а стрелка вниз~--- вперед.
\end{itemize}

Для ввода в командную строку нетекстового символа
служит команда~{\tt \^{}V}. Следующий за ней символ будет помещен
в командную строку без предварительной обработки.

После выполнения команды DECO не возвращается сразу в экранный режим,
а выдает приглашение в обычном режиме работы терминала, не стирая
экран. Воспринимаются команды {\tt F2} (пользовательское меню),
{\tt F7} (создание справочника), {\tt F9} (меню DECO), {\tt F10} (выход).
Пользователь может либо ввести новую команду, либо вернуться к
экранному режиму, нажав {\tt <Enter>}, либо перейти в режим
редактирования, нажав~{\tt \^{}P}.
В последнем случае DECO рисует не весь экран, а только обрамляющие
его строки и саму команду. Повторное нажатие~{\tt \^{}P} возвращает
его в обычное состояние.

Для примера в ситуации на рис.~\ref{bin} наберем:

\begin{example}
\litem{{\tt wc\vs}}
Введем команду и пробел.
\litem{$\uparrow$ $\downarrow$ $\leftarrow$ $\rightarrow$}
Выберем файл (например, {\tt tsimp.f}).
\litem{{\tt \^{}J}}
Слово {\tt tsimp.f} подставилось в командную строку.
\litem{{\tt <Enter>}}
Выполнилась набранная команда ``{\tt wc tsimp.f}''.
\end{example}

На экране появится картинка (рис.~\ref{wc}).

\fig{p16}{wc}{Экран после выполнения команды}

Введем теперь новую команду, не нажимая {\tt <Enter>}:
\begin{source}
\begin{verbatim}
ww *.c
\end{verbatim}
\end{source}
Мы ошиблись и вместо {\tt wc} набрали {\tt ww}. Перейдем в режим редактирования,
нажав~{\tt \^{}P} (рис.~\ref{edlin}).

\fig{p17}{edlin}{Редактирование строки}

Теперь отредактируем строку и выполним команду.
Затем нажмем {\tt <Enter>} и получим снова экран DECO (рис.~\ref{bin}).

Следующая возможность связана с повтором команд и историей работы.

\subsubsection{Повтор команд и протокол работы}

DECO ведет протокол команд, выполняемых пользователем,
и позволяет их повторять. Сюда относятся команды DECO:

\begin{example}
\litem{{\tt \^{}E}}
Подставить предыдущую команду (движение по протоколу назад).
\litem{{\tt \^{}X}}
Подставить следующую команду (движение по протоколу вперед).
\litem{{\tt \^{}B}}
Выдать протокол работы (рис.~\ref{history}).
\end{example}

\fig{p18}{history}{История работы}

Команды в режиме протокола:

\begin{example}
\litem{$\uparrow$, $\downarrow$}
Выбор команды из протокола.
\litem{{\tt <Enter>}}
Выполнить выбранную команду.
\litem{{\tt \^{}J}}
Подставить выбранную команду и перейти в режим редактирования команд.
\litem{F10}
Выйти из протокола, ничего не подставляя.
\end{example}

Например, мы хотим повторить команду ``{\tt wc tsimp.f}'' (рис.~\ref{history}).
Вызовем протокол работы клавишей~{\tt \^{}B}.
Выберем нужную команду стрелками и нажмем~{\tt \^{}J}.
Протокол исчезнет с экрана,
а в командной строке появится ``{\tt wc tsimp.f}''.
Снова войдем в протокол ({\tt \^{}B}), выберем команду, но
нажмем теперь {\tt <Enter>}.
Команда подставится и выполнится, а DECO будет ждать
следующую команду (рис.~\ref{wc}).
Введем~{\tt \^{}E} четыре раза причем в командную
строку будут подставляться команды в порядке, обратном их
выполнению. Напротив,~{\tt \^{}X} будет высвечивать команды по порядку.

Сотрем команду ({\tt \^{}Y})
и нажмем {\tt <Enter>}. DECO вернется в экранный режим (рис.~\ref{bin}).

\subsubsection{Набор встроенных команд}

Обычно DECO выполняет командную строку, вызывая системный
интерпретатор команд. Но некоторые команды (например, {\tt cd})
выполняются непосредственно самим DECO и называются {\em встроенными}.
Список встроенных команд приведен в таблице~\ref{builtin}.

\begin{table}[bp]
\begin{center}
\begin{tabular}{|ll|}
\hline
{\tt cd} & \\
{\tt chdir} & Переход в домашний каталог \\
& \\
{\tt cd dirname} & \\
{\tt chdir dirname} & Переход в указанный каталог \\
& \\
{\tt set name value} & \\
{\tt setenv name value} & Установка значения глобальной переменной \\
& \\
{\tt unset name} & \\
{\tt unsetenv name} & Удаление глобальной переменной \\
& \\
{\tt env} & \\
{\tt printenv} & Печать списка глобальных переменных \\
& \\
{\tt pwd} & Печать полного имени текущего каталога \\
& \\
{\tt exit} & Выход из DECO \\
\hline
\end{tabular}
\caption{Встроенные команды}
\label{builtin}
\end{center}
\end{table}

\subsection{Просмотр и редактирование файлов}

DECO позволяет просматривать или редактировать текущий файл
с помощью клавиш {\tt F3}~--- просмотр и {\tt F4}~--- редактирование.
По умолчанию используются встроенные программы просмотра и
редактирования. Посредством меню режимов (см. раздел ``Режимы работы'' ниже)
можно установить имена других программ для просмотра и редактирования (например,
команду {\tt less} для просмотра и {\tt vi} для редактирования).

\subsubsection{Просмотр файлов}

Вернемся к рис.~\ref{bin}. Выберем файл {\tt tsimp.f} и нажмем клавишу {\tt F3}.
Вызовется встроенная программа просмотра (рис.~\ref{view}).

\fig{p19}{view}{Просмотр файла}

Верхняя строка содержит размер файла в строках и в байтах.
Справа вверху~--- номер текущей строки и
текущий сдвиг экрана в колонках.

Файл можно листать, пользуясь стрелками (на 1 строку вверх-вниз
и на 40 колонок влево-вправо), клавишами {\tt <PgUp>} и {\tt <PgDn>},
{\tt <Home>} (в начало файла) и {\tt <End>} (в конец файла).
Дополнительные команды вводятся с помошью функциональных
клавиш, их список приведен на нижней строке:

\fig{p21}{hexview}{Шестнадцатеричный просмотр}

\begin{example}
\litem{F3~--- Raw}
Включает и выключает режим высвечивания символов с кодом больше
0200${}_8$. По умолчанию они выдаются в семибитном коде и выделяются цветом,
в режиме ``Raw''~--- выдаются в 8-ми битном коде на терминал.
\litem{F4~--- Hex}
Включает и выключает просмотр в шестнадцатеричном виде (рис.~\ref{hexview}).
Слева выведены коды символов, а справа~--- эти же символы в текстовом виде.
Можно перемещать курсор с текстовой
части экрана на шестнадцатеричную и обратно по клавише {\tt <Tab>}.
\litem{F5~--- Top}
Переход в начало файла.
\litem{F6~--- Bottom}
Переход в конец файла.
\litem{F7~--- Search}
Поиск. Если нажать {\tt F7},
появится запрос текста для поиска (рис.~\ref{search}).
Текст ищется, начиная с текущего места. Для продолжения
поиска достаточно нажать {\tt F7} и в ответ на запрос нажать {\tt <Enter>}.
В шаблоне поиска можно указывать произвольные символы, задавая
их шестнадцатеричный код в виде {\tt \bs xx}.
\litem{F9~--- Spaces}
Включает и выключает режим показа пробелов и табуляций. Пробелы изображаются
точками пониженной яркости, а табуляции~--- такими же символами подчеркивания.
\litem{F10~--- Quit}
Выход из команды просмотра.
\end{example}

\fig{p22}{search}{Поиск текста}

Управляющие символы с кодами от 0 до 31 приведены как символы пониженной
яркости; символы с кодами от 128 до 196 выведены инверсными символами
повышенной яркости.

\subsubsection{Редактирование файлов}

\fig{p23}{edit}{Встроенный редактор}

Встроенный редактор вызывается про клавише {\tt F4} (рис.~\ref{edit}).
В поле ``Char'' в правом верхнем углу высвечивается код текущего символа.

Система команд встроенного редактора очень проста:

\begin{example}
\litem{$\uparrow$ $\downarrow$ $\leftarrow$ $\rightarrow$}
Стрелки двигают курсор по файлу.
\litem{{\tt <BackSpace>}}
Удаляет символа слева от курсора.
\litem{{\tt <Del>}}
Удаляет символ под курсором.
\litem{{\tt \^{}Y}}
Удаляет текущую строку.
\litem{{\tt \^{}K}}
Удаляет текст от курсора до конца строки.
\litem{{\tt \^{}V}}
Следующий символ вставляется в текст без предварительной обработки.
Применяется для обработки нетекстовых символов.
\litem{F2~--- Save}
Вызывает запись файла.
\litem{F3~--- Raw}
Переключает режим отображения нетекстовых символов.
\litem{F5~--- Top}
Переход в начало файла.
\litem{F6~--- Bottom}
Переход в конец файла.
\litem{F7~--- Search}
Поиск по образу.
\litem{F8~--- Home}
Переход в начало экрана.
\litem{F9~--- Spaces}
Включает и выключает режим показа пробелов и табуляций.
\litem{F10~--- Quit}
Выход из редактора. Если в текст были внесены изменения,
выдается запрос, записывать ли измененный файл обратно,
выйти без записи или продолжить редактирование (рис.~\ref{save}).
\end{example}

\fig{p24}{save}{Выход из редактора}

Для того, чтобы вставить новую строку перед
текущей, нужно ввести {\tt <Enter>} в
начале текущей строки. В любом другом месте {\tt <Enter>}
разрежет строку на две части. Для слияния строк нужно ввести {\tt <BackSpace>}
в первой позиции строки.

Встроенный редактор предназначен в основном для внесения
небольших изменений в небольшие файлы. Он имеет ограниченный
размер редактируемого файла и ограниченный набор команд,
но зато прост в освоении. Пользователь может установить
вызов другого редактора по команде {\tt F4}, воспользовавшись
командой меню ``Options/Editor''.

\subsubsection{Создание файлов}

Для создания нового файла нужно выбрать справочник ``{\tt .}''
и нажать {\tt F4}. Система выдаст запрос имени файла, затем создаст
пустой файл с указанным именем и вызовет редактор.

\subsection{Операции над файлами}

Ниже описаны операции над файлами, выполняемые клавишами {\tt F5}~---~{\tt F8}
(перепись, перемещение, создание справочников, удаление).
Все они (кроме создания справочника) могут работать с текущим
файлом или с отмеченными файлами. Что такое отмеченные
файлы, как установить и снять отметку рассказывалось выше в
разделе ``Отметка файлов и ее использование''.

\subsubsection{Перепись и перемещение файлов}

Перепись файлов вызывается клавишей {\tt F5}, перемещение~--- клавишей {\tt F6}.
По этим командам либо текущий файл (если файлы не отмечались),
либо отмеченные файлы копируются (по {\tt F5}) или перемещаются
(по {\tt F6}) в справочник, имя которого запрашивается у пользователя;
по умолчанию это имя второго, противоположного окна. Если копируется или
перемещается один файл, можно указать не имя справочника, а новое имя файла.

Пример. Вернемся к первому примеру (рис.~\ref{screen}) и скопируем
файл {\tt tsimp.exe} в домашний справочник. Выберем в левом окне файл
{\tt tsimp.exe} стрелками и нажмем {\tt F5} (рис.~\ref{copy}).

\fig{p25}{copy}{Перепись файлов}

В запросе DECO предлагает подтвердить, что перепись
будет осуществляться в правое окно (в справочник {\tt /usr/user}), либо
ввести другое имя для переписи. У пользователя есть
следующие возможности:

\begin{itemize}
\item
Нажать Enter. Начнется перепись. На экране
появится соответствующее сообщение,
а по окончании переписи файла оно исчезнет.
\item
Всести новое имя справочника. При вводе первого же символа строка в
запросе сотрется, и имя будет вводиться вместо указанного в запросе.
\item
Отредактировать предложенное имя (см. раздел ``Ответы на запросы'').
\end{itemize}

Команда {\tt F6} работает аналогично, но файл не копируется,
а переименовывается (если это возможно) либо переписывается на новое
место и стирается на старом (используется команда {\tt mv}, а не {\tt cp}).

Перепишем теперь в справочник {\tt w} все файлы из справочника {\tt doc}.
Для этого нужно ввести:

\begin{example}
\litem{{\tt \^{}I}}
Перешли в правое окно.
\litem{{\tt cd doc}}
Перешли в справочник {\tt doc}.
\litem{{\tt + <Enter>}}
Выбрали все регулярные файлы в этом справочнике.
\litem{F5}
Вызвали перепись, появился запрос имени.
\litem{{\tt <Enter>}}
Подтвердили имя.
\end{example}

В результате все файлы из правого окна появятся в левом окне.
Теперь передвинем их обратно. Для этого нужно набрать:

\begin{example}
\litem{{\tt \^{}I}}
Вернулись в левое окно.
\litem{{\tt +}}
Получили запрос отмечаемых файлов.
\litem{{\tt \^{}Y} *.doc {\tt <Enter>}}
Отметили файлы с документацией.
\litem{F6}
Вызвали команду переименования, при этом появится запрос имени.
\litem{{\tt <Enter>}}
Подтвердили, что хотим переместить 4 файла из
текущего справочника в {\tt /usr/user/doc}.
\end{example}

Однако в правом справочнике такие файлы уже есть. Поэтому
система выдаст запрос (рис.~\ref{move}).

\fig{p26}{move}{Переименование файлов}

Предлагается выбор: либо записать указанный файл на место уже
существующего (по умолчанию), либо записать все файлы без дальнейших вопросов,
либо не перемещать указанный файл.
Выберем ``All'', нажмем {\tt <Enter>}, и отмеченные файлы переместятся в
справочник {\tt doc}.

\subsubsection{Создание справочника}

Команда {\tt F7} создает в текущем справочнике новый
справочник. Имя запрашивается у пользователя.

\subsubsection{Уничтожение файлов}

Клавиша {\tt F8} позволяет выполнять одну из самых
ответственных операций~--- удаление файлов и справочников.
Если нет отмеченных файлов, удаляется текущий файл или
справочник. Можно удалять только пустые справочники.
Если есть отмеченные файлы~--- удаляются все эти файлы.
В любом случае запрашивается подтверждение.

Пример. Создадим справочник {\tt /usr/user/w/tst} и перепишем туда
все документы из {\tt /usr/user/doc}. В правом окне у нас~--- справочник
{\tt doc}, в левом~--- {\tt w} (состояние после последнего примера):

\begin{example}
\litem{F7}
Создать справочник.
\litem{{\tt tst <Enter>}}
Ввести его имя.
\litem{{\tt cd tst}}
Перейти в созданный справочник.
\litem{{\tt \^{}I}}
Вернуться в справочник {\tt doc}.
\litem{{\tt + * <Enter>}}
Отметить все файлы в {\tt doc}.
\litem{F5}
Запустить перепись.
\litem{{\tt <Enter>}}
Подтвердить перепись.
\end{example}

Теперь перейдем в справочник {\tt tst}, отметим там все
файлы и удалим их:

\begin{example}
\litem{{\tt \^{}I}}
Перейти в левое окно.
\litem{{\tt + <Enter>}}
Отметить все файлы.
\litem{F8}
Запустить удаление.
\end{example}

\fig{p27}{delete}{Удаление файлов}

Система два раза переспросит, действительно ли вы выбрали четыре
файла и действительно ли вы хотите их уничтожить (рис.~\ref{delete}).
Получив утвердительный ответ, система сотрет
отмеченные файлы. Осталось стереть справочник:

\begin{example}
\litem{{\tt <Home>}}
Выбрать ``{\tt ..}''.
\litem{{\tt <Enter>}}
Вернуться в {\tt /usr/user}; справочник {\tt tst} оказался текущим.
\litem{F8}
Удалить.
\end{example}

Будет выдан запрос, действительно ли вы хотите удалить
справочник {\tt tst}. Нажмите {\tt <Enter>}, и справочник будет удален.

Если при получении запроса обнаружилось, что
пользователь ошибся и удалять ничего не нужно, достаточно на любой
запрос нажать {\tt F10}, либо выбрать ответ ``Cancel'',
и команда удаления будет отменена.

\section{Расширенные возможности DECO}

Выше были описаны базовые возможности DECO, рассчитанные на
широкое использование всеми пользователями. Ниже описаны расширенные
возможности, позволяющие настроить DECO на потребности конкретного
пользователя, а также не очень часто используемые команды, вызываемые
через системное меню.

\subsection{Выполнение файла. Правила умолчания}

Если в DECO нажата клавиша {\tt <Enter>}, а командная строка пуста,
происходит следующее:
\begin{itemize}
\item
Если файл~--- справочник, производится переход в этот справочник.
\item
Если файл~--- регулярный, и имеет признак выполнения (буква `x' в
атрибутах файла), то он выполняется.
\item
Если файл~--- регулярный, и не имеет признака выполняемости,
выполняется соответствующая его имени
команда, описанная в файле {\tt \~{}/.deco} (здесь `{\tt \~{}}'~--- домашний
справочник пользователя). Этот механизм позволяет
пользователю для каждого файла выполнять по умолчанию
действия, зависящие от его имени. Например, можно для
файла {\tt Makefile} запускать {\tt make}, для файлов с суффиксом ``{\tt .c}''
вызывать редактор, и т.п. Если файл {\tt \~{}/.deco} не найден,
описания ищутся в файле {\tt /usr/local/lib/deco/profile}, а затем
в {\tt /usr/lib/deco/profile}.
\end{itemize}

Файл с описаниями умолчаний имеет следующую структуру:

\begin{itemize}
\item
строки, начинающиеся с `{\tt \#}', содержат комментарии;
\item
каждое действие описывается парой строк вида:
\begin{source}
\begin{verbatim}
<шаблон1> <шаблон2> ... <шаблонN>
       <команда>
\end{verbatim}
\end{source}
Шаблоны начинаются с первой колонки, сравнение проводится
по правилам, описанным в разделе ``шаблоны''
\end{itemize}

\subsubsection{Макросы в описании умолчаний и в меню}

В командах в файле описания умолчаний, а также в меню пользователя
(см. ниже) могут встречаться макросы вида {\tt \%X}. Перед выполнением
команды на их место подставляются нужные параметры. Список макросов
приведен в таблице~ref{macro}.

\begin{table}[bp]
\begin{center}
\begin{tabular}{|cl|}
\hline
{\tt \%f} & имя текущего файла \\
{\tt \%b} & имя текущего файла без расширений \\
{\tt \%t} & список отмеченных файлов \\
{\tt \%d} & имя текущего каталога (последняя компонента) \\
{\tt \%c} & полное имя текущего каталога \\
{\tt \%u} & имя пользователя \\
{\tt \%g} & имя группы пользователя \\
{\tt \%\%} & символ `{\tt \%}' \\
\hline
\end{tabular}
\caption{Макро в имени команды}
\label{macro}
\end{center}
\end{table}

В начале команды могут стоять символы-признаки:

\begin{example}
\litem{{\tt -}}
После выполнения остаться в режиме окна.
\litem{{\tt @}}
Не заносить команду в протокол работы.
\end{example}

\subsubsection{Пример файла {\tt \~{}/.deco}}

Пример файла \~{}/.deco:
\begin{source}
\begin{verbatim}
# back-файл - стереть
*.b
       rm %f

# Makefile - выполнить ``make''
Makefile makefile *.mk
       make -f %f

# core - вызвать отладчик
core
       adb

# объектный файл - вызвать ``nm''
*.o
       nm %f | more

# архив - выдать каталог
*.a
       ar tv %f | more

# документ - сформатировать и записать
*.me
       nroff -me %f > %b.lp

# руководство - сформатировать и записать
*.man
       nroff -man %f > %b.lp
\end{verbatim}
\end{source}

\subsection{Пользовательские меню}

Пользователь DECO может создать собственное (пользовательское)
меню и затем вызывать его клавишей {\tt F2}. По этой команде
система ищет описание меню в файле .menu (в текущем справочнике),
а если его нет, то в \~{}/.menu, {\tt /usr/local/lib/deco/menu} и
в {\tt /usr/lib/deco/menu}.
Файл с описанием меню имеет следующую структуру:
\begin{itemize}
\item
строки, начинающиеся с `{\tt \#}', содержат комментарии;
\item
каждое действие описывается парой строк вида:
\begin{source}
\begin{verbatim}
<символ> <подсказка>
       команда
\end{verbatim}
\end{source}
\end{itemize}
Здесь:
\begin{example}
\litem{$<$символ$>$}
Либо одиночный символ в диапазоне: A$\ldots$Z, a$\ldots$z, 0$\ldots$9
(пишется в первой позиции строки), при нажатии которого будет вызываться
данная команда, либо двухбуквенное название клавиши {\tt F1}$\ldots${\tt F9}.
\litem{$<$подсказка$>$}
Текст, выводимый после этого символа и служащий подсказкой пользователю.
\litem{$<$команда$>$}
Команда ОС Unix, которая будет выполняться при
выборе указанной строки меню. Команда выполняется интерпретатором
{\tt /bin/sh} или {\tt /bin/csh} (в зависимости от установок),
она может содержать макросы вида {\tt \%X}, описанные в
предыдущем разделе.
Текст команды пишется с отступом, пробелы перед
командой игнорируются. Перед командой могут стоять также
специальные символы `{\tt -}' или `{\tt @}' (см. раздел ``Макросы'').
\end{example}

При описании меню можно использовать также встроенную команду
вида ``!имя-файла'', по которой вызывается новое меню из указанного файла.
Это позволяет создавать сложные меню с иерархической структурой.

Работу пользовательского меню объясним на примере. Вернемся к начальному
состоянию DECO на рис.~\ref{screen} и создадим в домашнем справочнике три
файла. Перейдем в правое окно ({\tt \^{}I}), выберем файл ``{\tt .}'',
нажмем {\tt F4}, зададим имя файла {\tt .menu}, затем введем текст,
приведенный ниже. Аналогично создадим и два других файла. Затем вернемся
в левое окно~--- справочник {\tt w}.

Файлы меню для данного примера:

Файл {\tt .menu}:
\begin{source}
\begin{verbatim}
#
# Пример меню со вложенными вызовами
#
F1 Floppy disk management
       !%h/.menuf

F2 Remote logins
       !%h/.menur

F3 Get mail
       -@mail
\end{verbatim}
\end{source}

Файл {\tt .menuf}:
\begin{source}
\begin{verbatim}
#
# Меню для операций с гибкими дисками
#
F      Format floppy as 1.2 MB
       -@format /dev/rfd096ds15

f      Format floppy as 360 k
       -@format /dev/rfd048ds9

c      Write current dir/file to floppy
       tar cvf /dev/rinstall %f

M      Mount floppy to /mnt
       /etc/mount /dev/install /mnt

U      Unmount floppy
       /etc/umount /dev/install

L      List mounted file systems
       /etc/mount
\end{verbatim}
\end{source}

Файл {\tt .menur}:
\begin{source}
\begin{verbatim}
#
# Меню для удаленного входа на компьютеры
#
a      Rlogin amet
       -@rlogin amet

b      Rlogin berta
       -@rlogin berta

c      Rlogin cospas
       -@rlogin cospas
\end{verbatim}
\end{source}

Текущий справочник~--- {\tt w} (рис.~\ref{w}).
Нажмем {\tt F2}. DECO сначала будет искать {\tt .menu} в
текущем справочнике, затем, поскольку там его нет,
в домашнем справочнике (правое окно на рис.~\ref{w}).

\fig{p28}{w}{Файлы меню}

В соответствии с файлом {\tt /usr/user/.menu} на экране
появится картинка меню (рис.~\ref{fmenu}).

\fig{p29}{fmenu}{Меню пользователя}

На ней слева написаны названия клавиш, а справа~--- действия системы
при нажатии на эти клавиши.
Стрелки справа от названия клавиш означают, что по данной строке
вызовется еще одно меню.
Если мы хотим, например, вызвать меню управления гибкими дисками,
мы должны либо нажать {\tt F1} (как это написано слева), либо
выбрать нужную строку и нажать {\tt <Enter>}.
DECO выберет строку с командой {\tt !\%h/.menuf} и подставит макро {\tt \%h},
получится команда {\tt !/usr/user/.menuf}. На экране
высветится следующее меню (рис.~\ref{fmenuf}).

\fig{p30}{fmenuf}{Меню форматирования}

Выдадим список смонтированных файловых систем (последняя строка в меню
на рис.~\ref{fmenuf}). Нажмем клавишу `{\tt L}', и получим выдачу
команды {\tt mount}.
Поскольку перед этой командой нет ни `{\tt -}', ни `{\tt @}', она
выполнится так,
как будто была введена с клавиатуры, то есть попадет в протокол
работы DECO, а DECO останется в неэкранном режиме работы. Нажмем
{\tt <Enter>} и восстановим исходную картинку (рис.~\ref{w}).

\subsection{Основное меню DECO}

Все команды DECO собраны в основное меню, вызываемое по клавише {\tt F9}.
Часто используемые команды, кроме того, могут вызываться и по
функциональным или {\tt <Ctrl>}-клавишам; часть таких
команд была рассмотрена выше. Рассмотрим последовательно команды
основного меню, останавливаясь на тех командах, которые не были
описаны ранее.

Нажмем клавишу {\tt F9}, и на экране появится основное меню (рис.~\ref{menu}).
Стрелки влево и вправо позволяют двигаться по верхней строчке экрана,
выбирая одно из спускающихся
меню ``Left'', ``Files'', ``Commands'', ``Options'', ``Right''.
Стрелки вверх и вниз служат для выбора команды из этих меню. Для
выполнения выбранной команды нужно нажать {\tt <Enter>}, для выхода
из меню~--- {\tt F10}.
Справа от некоторых команд показан альтернативный способ их вызова по
управляющим символам. Например, надпись ``Full screen~--- {\tt \^{}F}''
означает, что команду можно вызвать либо выбрав ее в меню,
либо нажав~{\tt \^{}F}.

Рассмотрим все группы команд.

\subsubsection{Режимы работы}

Это меню нужно освоить первым, так как здесь содержится
ряд необходимых настроек DECO (рис.~\ref{options}).

\fig{p31}{options}{Меню установки режимов}

Команды меню ``Options'':
\begin{example}
\litem{Switch panels~--- {\tt \^{}I}}
Переход из окна в окно, команда рассмотрена выше.
\litem{Swap panels~--- {\tt \^{}U}}
Меняет местами левое и правое окна.
\litem{Full Screen~--- {\tt \^{}F}}
Режим полного экрана, позволяет изменять размер окна.
В обычном режиме окна занимают
примерно половину экрана,
а остальное место отводится для набора команд.
Повторная команда восстанавливает
исходный режим работы.
В режиме ``Full Screen'' окно занимает максимально возможное место
на экране, оставляя под поле команд одну строку.
\litem{Double width~--- {\tt \^{}W}}
Режим двойной ширины экрана; позволяет расширить текущее окно
на всю ширину экрана.
Вместе с~{\tt \^{}F} используется для работы с большими справочниками.
Повторная команда восстанавливает исходный режим работы.
На рис.~\ref{dwidth} приведена выдача DECO
при одновременно включенных режимах ``Full screen'' и ``Double width''.

\fig{p32}{dwidth}{Двойная ширина окна}

\litem{Command line mode~--- {\tt \^{}P}}
Команда была уже описана выше (раздел ``Конструирование и
выполнение команд''), она позволяет переходить в режим редактирования
командной строки и обратно.
\litem{Show hidden files}
Управление режимом отображения файлов, имена которых
начинаются с точки.

\fig{p33}{viewer}{Запрос программы просмотра}

\fig{p34}{extview}{Установка внешней программы просмотра}

\litem{Viewer$\ldots$}
Задание имени программы для просмотра файлов по команде {\tt F3}
(рис.~\ref{viewer}).
``Built-in'' означает использование встроенной программы
просмотра. Если выбрать ``External'' и нажать {\tt <Enter>},
появится запрос имени программы просмотра (рис.~\ref{extview}).
Если ввести, например, ``{\tt less -Mepq}'', то при нажатии {\tt F3}
для просмотра файлов будет вызываться команда OC Unix {\tt less}
с флагами {\tt -Mepq}.
\litem{Editor$\ldots$}
Задание имени программы редактирования. Аналогично
предыдущей команде. По умолчанию используется встроенный
редактор.

\fig{p35}{shell}{Установка интерпретатора команд}

\litem{Shell$\ldots$}
Задание интерпретатора команд, с помощью которого
DECO выполняет команды системы Unix (рис.~\ref{shell}).
DECO может использовать либо интерпретатор команд {\tt /bin/sh}
(поле ``Shell'', по умолчанию),
либо интерпретатор {\tt /bin/csh} (поле ``Cshell'').
Разницу можно заметить, например,
набрав команду ``{\tt echo \~{}}''~--- в {\tt /bin/sh} ответом
будет ``{\tt \~{}}'', а в {\tt /bin/csh}~--- имя домашнего справочника
пользователя.
\litem{Save setup}
Сохранение установок. Текущие режимы DECO записываются
в файл {\tt .decoini} в домашний
справочник пользователя. При запуске DECO ищет начальные
установки сначала в файле {\tt \~{}/.decoini},
затем в {\tt /usr/local/lib/initfile} и в {\tt /usr/lib/initfile}
и устанавливает указанные в них режимы работы.
\end{example}

\subsubsection{Управление окнами}

Меню ``Left'' и ``Right'' позволяют настроить формат
левого и правого окон. Меню ``Left'' приведено на рис.~\ref{menu},
меню ``Right'' полностью аналогично, но относится к
правому окну. Здесь имеются такие команды:
\begin{example}
\litem{Brief, Long, Full}
Режимы отображения файлов на экране. Текущий режим
помечен звездочкой. В режиме Brief показываются
только имена файлов и их типы (все предыдущие примеры,
начиная с рис.~\ref{screen}). Long показывает также
длину файлов и атрибуты доступа (рис.~\ref{long}).
\end{example}

\fig{p37}{long}{Режим выдачи ``Long''}

Full включает режим двойной ширины (Double width, см. предыдущий раздел)
и показывает всю информацию о файле (рис.~\ref{full}).

\fig{p38}{full}{Режим выдачи ``Full''}

Добавляются такие атрибуты, как имя владельца и группы,
а также дата и время модификации. В нижней части окна в строке статуса
текущего файла указаны: номер устройства, номер индексного узла,
количество ссылок, дата и время последнего обращения, дата и время
изменения состояния.

\begin{example}
\litem{Status~--- {\tt \^{}L}}
Включает и выключает показ статуса текущего справочника. Статус
выдается в противоположном окне. В режиме двойной ширины
окна статус можно увидеть, нажав {\tt <Tab>}. Пример статуса
изображен на рис.~\ref{status}.
\end{example}

\fig{p39}{status}{Окно статуса}

В окне статуса показывается: имя справочника, количество файлов в
справочнике и суммарный размер, а также количество отмеченных файлов и
сумма их размеров.

\begin{example}
\litem{Aligh extensions}
Управляет режимом выравнивания расширений имен файлов по правому краю.
\litem{Sort by name}
Установка режима сортировки файлов в окне по имени.
\litem{Extension}
Установка режима сортировки по расширению.
\litem{Time}
Установка режима сортировки по времени модификации.
\litem{Size}
Установка режима сортировки по размеру.
\litem{Unsorted}
Отмена сортировки файлов по параметрам. Режим сортировки по типу
файла при этом не изменяется.
\litem{Reverse}
Установка режима обратной сортировки.
\litem{Sort by type}
Отмена сортировки файлов по типу. Режим сортировки по параметрам
при этом не изменяется.
\litem{Re-read~--- {\tt \^{}R}}
Команда смены справочника. Эта команда (может вызываться по~{\tt \^{}R} либо
из меню) была описана выше.
\litem{Pattern}
Команда запрашивает и устанавливает {\em шаблон видимости файлов}.
Если такой шаблон задан, в окне высвечиваются только файлы,
имена которых удовлетворяют ему. Правила определения шаблонов
приведены выше (см. ``Шаблоны'').
\end{example}

Пример. В левом окне на рис.~\ref{status} установим
шаблон ``{\tt \^{}*.o}'', который
означает ``все, что не оканчивается на `{\tt .o}'\,''. Результат на
рис.~\ref{pattern}.

\fig{p40}{pattern}{Установка шаблона имени}

\subsubsection{Операции над файлами}

Меню ``Files'' приведено на рис.~\ref{files}. Большинство содержащихся
здесь команд было описано выше (см. ``Операции над файлами'').

\begin{example}
\litem{Help~--- F1}
Выдача краткой подсказки.
\litem{User Menu~--- F2}
Вызов пользовательского меню.
\litem{View~--- F3}
Просмотр файла.
\litem{Edit~--- F4}
Редактирование файла.
\litem{Copy~--- F5}
Перепись файлов.
\litem{Link}
Создание ссылок на файлы.
Аналогично ``Copy'', но вместо команды {\tt cp}
использует команду {\tt ln} (см. ln(1)).
\litem{Symlink}
Создание символических ссылок.
Аналогично ``Copy'', но вместо команды {\tt cp}
использует команду ``{\tt ln -s}'' (см. ln(1)).
\litem{Rename/move~--- F6}
Переименование файлов и каталогов.
\litem{Make directory~--- F7}
Создание каталога.
\litem{Delete~--- F8}
Удаление файлов и каталогов.
\litem{Select Group~--- {\tt +}}
Установка отметки на группу файлов по шаблону.
\litem{Unselect Group~--- {\tt -}}
Снятие отметки с группы файлов по шаблону.
\litem{Quit~--- F10}
Выход из DECO.
\end{example}

\fig{p41}{files}{Меню операций над файлами}

\subsubsection{Разные команды}

Меню Commands (рис.~\ref{commands}) содержит разные команды, не
вошедшие в остальные меню.

\fig{p42}{commands}{Меню команд}

\begin{example}
\litem{Run subshell}
По этой команде вызывается системный интерпретатор команд ({\tt /bin/sh} или
{\tt /bin/csh}, как указано в установке режимов).
После выхода из него DECO продолжает работу.
\litem{Compare directories}
По этой команде производится сравнение справочников в левом и правом
окне. В каждом окне отмечаются файлы, которые не имеют точной копии в
противоположном окне.
Например, на рис.~\ref{cmpdir} показан результат сравнения
справочников {\tt /usr/user} и {\tt /usr/user/w} из примера на рис.~\ref{w}.

\fig{p43}{cmpdir}{Сравнение каталогов}

\litem{Find file~--- {\tt \^{}K}}
Выбор файла по имени (см. ``Поиск файла по имени'').
\litem{History~--- {\tt \^{}B}}
Работа с протоколом команд (см. ``Повтор команд и протокол работы'').
\litem{Home directory~--- {\tt \^{}{[}}}
Команда перехода в домашний справочник (то же, что и {\tt cd}); может
вызываться как~{\tt \^{}\bs}.
\litem{Root directory~--- {\tt \^{}\^{}}}
Аналогично предыдущей команде, но переходит в корневой
справочник (``{\tt cd /}'').
\litem{Redraw screen~--- {\tt \^{}{]}}}
Команда перерисовки экрана.
\litem{Menu file edit}
Редактирование файла меню.
\litem{Extensions file edit}
Редактирование файла расширений.
\end{example}

\end{document}
